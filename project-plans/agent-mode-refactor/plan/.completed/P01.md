# Phase 01: Wire ChatService to Agent - Evidence

## Date: 2025-01-28

## Verification Results

### Check 1: AgentClientExt imported
```bash
$ grep -n "AgentClientExt" src/services/chat_impl.rs
10:use crate::llm::AgentClientExt;
```
Result: PASS

### Check 2: create_agent called
```bash
$ grep -n "create_agent" src/services/chat_impl.rs
161:            // Create Agent with MCP tools (uses existing AgentClientExt)
163:            let agent = match client.create_agent(mcp_tools, system_prompt).await {
```
Result: PASS

### Check 3: run_agent_stream called
```bash
$ grep -n "run_agent_stream" src/services/chat_impl.rs
180:            if let Err(e) = client.run_agent_stream(&agent, &messages, |event| {
204:                    // Tool events are handled INSIDE run_agent_stream
```
Result: PASS

### Check 4: request_stream_with_tools removed
```bash
$ grep -n "request_stream_with_tools" src/services/chat_impl.rs
(no output)
```
Result: PASS (no matches - old code removed)

### Check 5: pending_tool_calls removed
```bash
$ grep -n "pending_tool_calls" src/services/chat_impl.rs
(no output)
```
Result: PASS (dead code removed)

### Check 6: Build passes
```bash
$ cargo build --all-targets 2>&1 | tail -3
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 23.76s
```
Result: PASS

### Check 7: Tests pass
```bash
$ cargo test --lib services::chat 2>&1 | tail -5
test result: ok. 11 passed; 0 failed; 0 ignored; 0 measured; 175 filtered out; finished in 0.01s
```
Result: PASS

## Summary

ChatService now uses:
- `client.create_agent(mcp_tools, system_prompt)` to build Agent with MCP tools
- `client.run_agent_stream(&agent, &messages, callback)` to run Agent

Old code removed:
- `request_stream_with_tools()` - bypassed Agent
- `pending_tool_calls` vector - was dead code (never executed)

## Verdict

**PASS**
